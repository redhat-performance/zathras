---
# tasks file for install_pbench_tests
- name: pbench test install results default
  lineinfile:
    path: "/tmp/pbench_test_inst_status"
    line: "status: success"
    create: yes

- name: install pbench tests if required
  block:
  - name: install pbench benchmarks
    package:
      name: "{{ item }}"
      state: present
    ignore_errors: yes
    register: pbench_tool
    with_items:
    - uperf
    - fio
  - name: install report
    debug:
      var: pbench_tool.results[0]
  - name: install report
    debug:
      var: pbench_tool.results[1]

#
# install pbench tools
#
  - name: fetch pbench tool vars
    ansible.builtin.include_vars:
      name: pbench_tools_to_install
      file: pbench_tools.yml
      
  - name: install pbench tools
    vars: "{{ pbench_tools_to_install }}"
    include_role:
      name: pbench_install_tools
      apply:
        become: yes

  when:
    - config_info.pbench_install == 1
    - config_info.os_vendor == "rhel"
    - config_info.init_system == "yes"
